<!DOCTYPE html>
<html>
<head>
  <title>P.Rail - Terra-Nova — Play</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <meta name="author" content="P.Rail">
  <link rel="stylesheet" href="style.css">
  
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" type="text/css" href="interpreter/roboto.css">
<link rel="stylesheet" type="text/css" href="interpreter/jquery.powertip.css">
<link rel="stylesheet" type="text/css" href="interpreter/toastr.css">
<link rel="stylesheet" type="text/css" href="interpreter/vex.css">
<link rel="stylesheet" type="text/css" href="interpreter/vex-theme-plain.css">

<link rel="stylesheet" type="text/css" href="interpreter/haven.css">
<link rel="stylesheet" type="text/css" href="interpreter/vorple.css">
  
 </head>
<body class="play">
<div class="container">
<div class="coverimage"><span><a href="Cover.jpg"><img src="Small Cover.jpg" border="1"></a></span></div>
<div class="links">
<div class="smalltitle">Terra-Nova</div>
<ul>
<li><a href="index.html">Home page</a></li>
</ul>
</div>

<div id="gameport">
<main id="vorple">
<div id="loader">
<h2 id="loader-message">Loading scripts</h2>
<div id="spinner">V</div>
</div>
</main>

<script src="interpreter/vorple.min.js"></script>
<script src="interpreter/Terra-Nova.gblorb.js"></script>

<script>
if( location.protocol === "file:" ) {
$( 'body' )
.empty()
.html( "<div><p>You are currently viewing the page from the filesystem. " +
"Unfortunately Vorple requires that the page is viewed through " +
"the HTTP protocol, that is, you'll need to either upload it " +
"to the Internet or install a local server.</p>" +
'<p>See <a href="https://vorple-if.com/docs/localhost" style="color:#dde">vorple-if.com/docs/localhost</a> ' +
"for more information.</p>" +
"</div>" )
.find( 'div' )
.css({
margin: "2em",
padding: "1em",
color: "#fff",
backgroundColor: "rgb(137, 50, 58)",
border: "3px solid gray"
});

throw new Error( "Vorple can't be run from the filesystem" );
}

$( function() {
$( '.container, .interpretercredit' ).remove();
});

vorple.options = {
autosave: false,
engineColors: false,
story: ""
};

vorple.debug.off();
vorple.init();

</script>
<script>
// Create a hidden canvas element at page load
const hiddenCanvas = document.createElement('canvas');
hiddenCanvas.style.display = 'none';
document.body.appendChild(hiddenCanvas);  

const hiddenCtx = hiddenCanvas.getContext('2d');

function setBackgroundColorAndTextColor(rgb) {
// Ensure the RGB value is a hexadecimal color code
if (!rgb.startsWith('#')) {
console.error('Invalid RGB value. Must start with "#"');
return;
}

// Extract the hexadecimal color code
const hexCode = rgb.substring(1);

// Convert hexadecimal color code to RGB values
const red = parseInt(hexCode.substring(0, 2), 16);
const green = parseInt(hexCode.substring(2, 4), 16);
const blue = parseInt(hexCode.substring(4, 6), 16);

// Calculate luminance for contrast determination
const luminance = (0.299 * red + 0.587 * green + 0.114 * blue) / 255;

// Choose contrasting text color based on luminance
let textColor = luminance > 0.5 ? "black" : "white";

// Additional logic for more sophisticated color choices
if (luminance > 0.7) {
// For very light backgrounds, consider a darker shade of black
textColor = "#333333";
} else if (luminance < 0.3) {
// For very dark backgrounds, consider a lighter shade of white
textColor = "#cccccc";
}

// Set background and text colors
document.getElementById('vorple').style.backgroundColor = rgb;
let bs = document.getElementById('lineinput-field');
if ( bs != null ) {
bs.style.color = textColor;
//bs.style.fontFamily = "Georgia";
}

bs = document.getElementById('lineinput-prefix');
if ( bs != null ) {
bs.style.backgroundColor = rgb;
bs.style.color = textColor;
//bs.style.fontFamily = "Georgia";
}

bs = document.getElementById('output');
if ( bs != null ) {
bs.style.backgroundColor = rgb;
bs.style.color = textColor;
}

bs = document.getElementById('my_container');
if ( bs != null ) {
bs.style.backgroundColor = rgb;
bs.style.color = textColor;
}

bs = document.getElementById('side_window');
if ( bs != null ) {
bs.style.backgroundColor = rgb;
bs.style.color = textColor;
}

bs = document.getElementById('window0');
if ( bs != null ) {
bs.style.backgroundColor = rgb;
bs.style.color = textColor;
}

bs = document.querySelector('.status-line-container');
if ( bs != null ) {
bs.style.backgroundColor = rgb;
bs.style.color = textColor;
}

document.body.style.color = textColor;
document.body.style.backgroundColor = rgb;
}

function getMostCommonRGB(image) {
// Set canvas dimensions to match the image
hiddenCanvas.width = image.width;
hiddenCanvas.height = image.height;

// Draw the image onto the hidden canvas
hiddenCtx.drawImage(image, 0, 0);

// Get the image data
const imageData = hiddenCtx.getImageData(0, 0, hiddenCanvas.width, hiddenCanvas.height);
const data = imageData.data;

// Create a map to store RGB values and their frequencies
const rgbMap = {};

// Iterate over each pixel and increment the frequency of its RGB value
for (let i = 0; i < data.length; i += 4) {
const r = data[i];
const g = data[i + 1];
const b = data[i + 2];
const key = `${r},${g},${b}`;
rgbMap[key] = (rgbMap[key] || 0) + 1;
}

// Find the most frequent RGB value
let mostCommonRGB = null;
let maxFrequency = 0;
for (const key in rgbMap) {
if (rgbMap[key] > maxFrequency) {
mostCommonRGB = key;
maxFrequency = rgbMap[key];
}
}

let result = `#${mostCommonRGB.split(',').map(Number).map(v => v.toString(16).padStart(2, '0')).join('')}`;
return result;
}

function updateImage(src, backgroundColor = 'default') {
var sideWindow = document.getElementById('side_window');
sideWindow.innerHTML = '<img src="' + src + ' "style="max-width:500px;">';

const image = new Image();
image.src = src;

image.onload = () => {
let mostCommonRGB = getMostCommonRGB(image);
if (backgroundColor != 'default' ) {
mostCommonRGB = backgroundColor;   // override background color (rare)
}
const textColor = setBackgroundColorAndTextColor(mostCommonRGB);
};
}

// These function all have to do with trying to RESTORE the interface after
// the user types 'restore' ... it is still imperfect, but pretty good.
var lastCmd;

// Function to return the last command the user typed
function getLastCommand() {
let result = "none";
if (lastCmd) {
result = lastCmd;
}
//console.log("lastCmd:", result);
return result;
}

var restoreRequested;

// Function to return the last command the user typed
function checkRestore() {
let result = restoreRequested;
restoreRequested = 'no';  // reset to not fire
//console.log("checkRestore:", result);
return (result && result == "yes");
}

document.addEventListener('DOMContentLoaded', function() {
// Attach an event listener to the document (or a parent element) for keydown events
document.body.addEventListener('keydown', function(event) {
// Check if the target of the event is the dynamically created input field
const inputField = document.getElementById('lineinput-field');

if (inputField && event.target === inputField) {
// Check if the pressed key is 'Enter' (key code 13)
if (event.key === 'Enter' || event.keyCode === 13) {
//event.preventDefault();  // Prevent the default form submission

// Log the value of the input field to the console
//console.log("Line input value:", inputField.value);
lastCmd = inputField.value;
if ( lastCmd.toLowerCase() == "restore" || lastCmd.toLowerCase() == "undo" ) {
restoreRequested = 'yes';
}

}
}
});
});

vorple.addEventListener('init', function() {
var containerDiv = document.createElement('div');
containerDiv.id = 'my_container';

// move side_window inside container
var sideWindow = document.createElement('div');
sideWindow.id = 'side_window';

// Move sideWindow & window0 into new container
var window0 = document.getElementById('window0');

containerDiv.appendChild(sideWindow);
containerDiv.appendChild(window0);

// move container inside output div
var outputDiv = document.getElementById('output');
outputDiv.appendChild(containerDiv);

// Adjust CSS styles as needed for layout
sideWindow.style.marginTop = '10px';
sideWindow.style.paddingTop = '10px';
sideWindow.style.paddingRight = '10px';

containerDiv.style.height = '95vh';
containerDiv.style.paddingTop = '10px';
containerDiv.style.marginTop = '10px';
containerDiv.style.display = 'grid';
containerDiv.style.gridTemplateColumns = '500px 1fr';

window0.style.overflowY= 'auto';
window0.style.paddingTop = '10px';
window0.style.paddingLeft = '10px';
window0.style.marginTop = '10px';

var playArea = document.getElementById('output');
playArea.style.maxWidth = '1400px';

//document.body.style.fontFamily = "Georgia";
document.body.style.fontSize = "14pt";
});

// All our images
const imageArray = [
'assembly-line-scale-1.jpg',
'blackwood-portrait-3.jpg',
'blast-off.gif',
'blocked-tunnel-1.jpg',
'blocked-tunnel-darker-new.jpg',
'blocked-tunnel-darker.jpg',
'bot-assembly-4.jpg',
'caretaker-closeup-4.jpg',
'crumbling-ruins.jpg',
'cyborg-agony-1.jpg',
'cyborg-blocks-your-path-3.jpg',
'cyborg-hybrid-1.jpg',
'dark-tunnel.jpg',
'dead-game-over-1.jpg',
'docking-bay-normal-hand.jpg',
'docking-bay-robotic-hand.jpg',
'drone-attack-9.jpg',
'drones-appear-1.jpg',
'embrace-harmony-poster-rotated-1.jpg',
'equipment-storage-3.jpg',
'foundry-1.jpg',
'future-village-5.jpg',
'future-village-n.jpg',
'hiroshi-portrait-1.jpg',
'horizon-east.jpg',
'horizon-north.jpg',
'horizon-northeast.jpg',
'horizon-northwest.jpg',
'horizon-south.jpg',
'horizon-southwest.jpg',
'horizon-up-6.jpg',
'horizon-west.jpg',
'kai-at-console-in-bay-1.jpg',
'kai-captured-normal-hand.jpg',
'kai-captured-robotic-hand.jpg',
'kai-cyborg-5.jpg',
'kai-in-orbit-normal-hand.jpg',
'kai-in-orbit-robotic-hand.jpg',
'kai-is-grabbed-33.jpg',
'kai-modified-2.jpg',
'kai-new-hand-3.jpg',
'kai-on-belt-f.jpg',
'kai-on-bridge-1.jpg',
'lab-with-caretaker-e.jpg',
'lab-without-caretaker.jpg',
'ladder-down-5a.jpg',
'ladder-up-8.jpg',
'lander-fff.jpg',
'lander-interior-5.jpg',
'lander-museum-z.jpg',
'lava-pit-1.jpg',
'legacy-bay-1.jpg',
'legacy-bridge-2.jpg',
'legacy-deep-space-11a.jpg',
'legacy-deploys-zephyr-1.jpg',
'legacy-docking-approach-5.jpg',
'legacy-leaves-earth-55.jpg',
'legacy-orbits-terra-nova-aa.jpg',
'okafor-portrait-1.jpg',
'parachute-2.jpg',
'portal-view-of-terra-nova-3.jpg',
'quantum-projector-1.jpg',
'restricted-hallway-1.jpg',
'restricted-hallway-beams-1.jpg',
'ruins-solar-glass-1.jpg',
'ruins-solar-glass-2.jpg',
'settlement-1.jpg',
'shadow-beast-attacks-3.jpg',
'shrine-5.jpg',
'splash-4.jpg',
'stein-portrait-2.jpg',
'stone-tower-1.jpg',
'stone-tower-interior-3.jpg',
'sundown-1.jpg',
'telescope-damaged-1.jpg',
'tower-animation.gif',
'tower-summit-4.jpg',
'tunnel-2-beetle.jpg',
'tunnel-2.jpg',
'tunnel-3.jpg',
'tunnel-beast-robot-3.jpg',
'tunnel-beast-robot-freed-3.jpg',
'unblocked-tunnel-b.jpg',
'volcano-landscape-3.jpg',
'well-1.jpg',
'zephyrs-landing-ruins-6.jpg'
];

function preloadImages(imageFiles) {
imageFiles.forEach(function(file) {
const img = new Image();
img.src = "img/" + file;
});
}

console.error('Preloading images...');
preloadImages(imageArray);
</script>
</div>

</div>
<div class="interpretercredit"><a href="https://vorple-if.com">Vorple</a></div>
</body>
</html>

